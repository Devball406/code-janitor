{% extends "base.html" %}

{% block content %}

<div id="job_status">
</div>

<div id="result_page">

<p>Detail for search done on {{ search.path }} at {{ search.start_time }}:</p>
{% if search.group_list %}<p>Keyword groups checked: {% for g in grouplist %}{{ g.group }},{% endfor %}</p>{% endif %}

{% if searched %}
<ul>
{% for item in searched %}
  <li>{{ item.file_path }}, line {{ item.line_number }}: 
      {{ item.keyword_found }}</li>
{% endfor %}
</ul>
{% else %}
<p>No keywords defined at the time were found.</p>
{% endif %}

{% if not_searched %}
<p>Files found but not searched:</p>
<ul>
{% for item in not_searched %}
  <li>{{ item.file_path }}: {{ item.keyword_found }}</li>
{% endfor %}
</ul>
{% endif %}

{% if not search.completed %}
<p>This job did not complete for some reason.  Any results listed above
may be suspect.</p>
{% endif %}

</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript">

function setdefaults()
{
{% if not task_running %}
  document.getElementById("result_page").style.visibility = 'visible';
  document.getElementById("job_status").innerHTML = "";
{% else %}
  document.getElementById("result_page").style.visibility = 'hidden';
  document.getElementById("job_status").innerHTML = "Getting job status...";
  setTimeout("reload_status();", 5000);
{% endif %}
}

function reload_status()
{
  xmlhttp = new XMLHttpRequest();
  xmlhttp.open("GET", "/search/taskstatus/", false);
  xmlhttp.send();
  if (xmlhttp.responseText == "None") {
    location.reload();
  } else {
    document.getElementById("result_page").style.visibility = 'hidden';
    document.getElementById("job_status").innerHTML = xmlhttp.responseText;
    setTimeout("reload_status();", 1000);
  }
}

</script>

{% endblock %}
